@model IEnumerable<WebTracNghiemTiengAnhTHPT.Models.CauHoi>
@{
    ViewBag.Title = "ChiTietDeThi";
    Layout = "~/Areas/admin/Views/Shared/_AdminLayout.cshtml";
    var groupedItems = Model.GroupBy(item => new { item.NhomCauHoi.MaNhom, item.NhomCauHoi.NoiDung });
}

<h2>Thêm câu hỏi</h2>

<h2>Chi tiết</h2>

<div class="">
    @foreach (var group in groupedItems)
    {
        <h4>@group.Key.NoiDung</h4>

        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Mã Câu Hỏi</th>
                    <th>Câu Hỏi</th>
                    <th>Đáp Án</th>
                    <th>Đáp Án Chính Xác</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in group)
                {
                    <tr id="row-@item.MaCauHoi">
                        <td>@item.MaCauHoi</td>
                        <td>@Html.DisplayFor(modelItem => item.NoiDung)</td>
                        <td>
                            <ul>
                                <li>A: @Html.DisplayFor(modelItem => item.DapAnA)</li>
                                <li>B: @Html.DisplayFor(modelItem => item.DapAnB)</li>
                                <li>C: @Html.DisplayFor(modelItem => item.DapAnC)</li>
                                <li>D: @Html.DisplayFor(modelItem => item.DapAnD)</li>
                            </ul>
                        </td>
                        <td>@Html.DisplayFor(modelItem => item.DapAnChinhXac)</td>
                        <td>
                            <button type="button" class="btn btn-primary">Sửa</button>
                            <button type="button" class="btn btn-danger btn-sm" onclick="deleteQuestion('@item.MaCauHoi')">Xóa</button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    }
</div>

<script>
    function deleteQuestion(maCauHoi) {
        if (confirm("Bạn có chắc chắn muốn xóa câu hỏi này không?")) {
            // Send an AJAX request to update the isDeleted field
            $.ajax({
                url: '@Url.Action("DeleteQuestion", "QuanLyDeThi")',
                type: 'POST',
                data: { maCauHoi: maCauHoi },
                success: function (response) {
                    if (response.success) {
                        // Hide the row from the table
                        $('#row-' + maCauHoi).hide();
                    } else {
                        alert("Không thể xóa câu hỏi. Vui lòng thử lại.");
                    }
                },
                error: function () {
                    alert("Có lỗi xảy ra. Vui lòng thử lại.");
                }
            });
        }
    }
</script>
