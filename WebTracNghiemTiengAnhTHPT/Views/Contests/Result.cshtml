@model IEnumerable<WebTracNghiemTiengAnhTHPT.Models.KetQua>

@{
    ViewBag.Title = "ChiTietKyThi";
    Layout = "~/Views/Shared/LayoutWeb.cshtml";
    var groupedItems = Model.SelectMany(k => k.ChiTietKetQuas)
                            .GroupBy(item => new { item.CauHoi.MaNhom, item.CauHoi.NoiDung });
    var isFirst = true;
}

<h2>ChiTietKyThi</h2>

<div class="container">
    <div class="row">
        <form action="/Contests/Result?MaDe=@ViewBag.MaDe" method="post">
            <div class="col-12 d-lg-flex flex-lg-row flex-column">
                <div class="col-lg-9 col-12 ">
                    <div>
                        @foreach (var group in groupedItems)
                        {
                            <button type="button" class="btn btn-light" onclick="showGroup('@group.Key.MaNhom')">
                                Phần thi @group.Key.MaNhom
                            </button>
                        }
                    </div>
                    @foreach (var group in groupedItems)
                    {
                        <div class="group-container" id="group-container-@group.Key.MaNhom" style="display: @(isFirst ? "block" : "none");">
                            <div class="bg-light "> @group.Key.NoiDung</div>
                            @foreach (var item in group)
                            {
                                <div class="item-container border p-3 mb-3">
                                    <div class="field mb-2">
                                        <strong>@item.MaCauHoi : @Html.DisplayFor(modelItem => item.CauHoi.NoiDung) </strong>
                                    </div>
                                    <!-- Answer choices with radio buttons -->
                                    <label class="form-check-label bg-info w-100 my-1 border-danger border-2" for="dapAnA_@item.MaCauHoi">
                                        <span class="form-check mb-2">
                                            <input class="form-check-input" type="radio" name="answer_@item.MaCauHoi" id="dapAnA_@item.MaCauHoi" value="A">
                                            @Html.DisplayFor(modelItem => item.CauHoi.DapAnA)
                                        </span>
                                    </label>
                                    <label class="form-check-label bg-info w-100  my-1" for="dapAnB_@item.MaCauHoi">
                                        <span class="form-check mb-2">
                                            <input class="form-check-input" type="radio" name="answer_@item.MaCauHoi" id="dapAnB_@item.MaCauHoi" value="B">
                                            @Html.DisplayFor(modelItem => item.CauHoi.DapAnB)
                                        </span>
                                    </label>
                                    <label class="form-check-label bg-info w-100  my-1" for="dapAnC_@item.MaCauHoi">
                                        <span class="form-check mb-2">
                                            <input class="form-check-input" type="radio" name="answer_@item.MaCauHoi" id="dapAnC_@item.MaCauHoi" value="C">
                                            @Html.DisplayFor(modelItem => item.CauHoi.DapAnC)
                                        </span>
                                    </label>
                                    <label class="form-check-label bg-info w-100  my-1" for="dapAnD_@item.MaCauHoi">
                                        <span class="form-check mb-2">
                                            <input class="form-check-input" type="radio" name="answer_@item.MaCauHoi" id="dapAnD_@item.MaCauHoi" value="D">
                                            @Html.DisplayFor(modelItem => item.CauHoi.DapAnD)
                                        </span>
                                    </label>
                                    <div class="field">
                                        <strong>DapAnChinhXac:</strong> @Html.DisplayFor(modelItem => item.CauHoi.DapAnChinhXac)
                                    </div>
                                </div>
                            }
                        </div>
                        isFirst = false;
                    }
                </div>
                <div class="col-lg-3 col-12 bg-light border border-primary rounded-3 p-4 mx-1 ">
                    Số đáp án đúng: @ViewBag.SoDapAn / @ViewBag.SoCauHoi
                </div>
            </div>
        </form>
    </div>
</div>
<script>
    function showGroup(maNhom) {
        console.log(maNhom);
        var groupContainers = document.querySelectorAll('.group-container');
        groupContainers.forEach(function (container) {
            container.style.display = 'none';
        });

        var selectedContainer = document.getElementById('group-container-' + maNhom);
        if (selectedContainer) {
            selectedContainer.style.display = 'block';
        }
    }
</script>
